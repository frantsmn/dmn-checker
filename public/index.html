<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Domain Checker</title>

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#2d89ef">
    <meta name="theme-color" content="#111111">

    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/bootstrap.min.css">
</head>

<body>

    <header class="container mb-3">
        <h1>
            <a href="/" style="font-size: 0.62em;">Domain Checker</a>
        </h1>
    </header>

    <main class="container mt-2" id="app">

        <ul class="nav nav-tabs" id="tablist" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="list-tab" data-toggle="tab" href="#list" role="tab" aria-controls="home"
                    aria-selected="true">Проверка списка</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="query-tab" data-toggle="tab" href="#query" role="tab" aria-controls="profile"
                    aria-selected="false">Проверка по запросу</a>
            </li>
        </ul>

        <div class="tab-content">
            <div class="tab-pane show active" id="list" role="tabpanel" aria-labelledby="list-tab">

                <div class="card border-secondary border-top-0 rounded-0 mb-5">

                    <div class="row card-body">

                        <!-- Форма -->
                        <div class="col">
                            <form @submit.prevent="onSubmit" class="col mb-3">
                                <div class="form-group">
                                    <label class="lead" for="domains">Домены на проверку</label>
                                    <textarea class="form-control" name="domains" id="domains" rows="7"
                                        placeholder="example.com" v-model="textareaText"></textarea>
                                </div>

                                <input class="btn btn-primary mr-2 mb-3" type="submit" v-bind:disabled="isBusy"
                                    value="Проверить">
                                <input class="btn btn-outline-danger mb-3" type="reset" @click="onReset"
                                    v-bind:disabled="isBusy" value="Очистить">
                            </form>
                        </div>

                        <!-- Сортировка -->
                        <div class="col-xs-12 col-md">
                            <div class="col border border-secondary rounded p-3 mb-3">
                                <div class="form-group">
                                    <label class="lead">Сортировка</label>
                                </div>

                                <div class="form-group">
                                    <div class="custom-control custom-radio mb-1">
                                        <input v-model="sort" id="sort-by-alphabet" class="custom-control-input"
                                            type="radio" name="sort" value="alphabet">
                                        <label class="custom-control-label" for="sort-by-alphabet">
                                            по алфавиту
                                        </label>
                                    </div>

                                    <div class="custom-control custom-radio mb-1">
                                        <input v-model="sort" id="sort-by-age" class="custom-control-input" type="radio"
                                            name="sort" value="age">
                                        <label class="custom-control-label" for="sort-by-age">
                                            по возрасту
                                        </label>
                                    </div>

                                    <div class="custom-control custom-radio">
                                        <input v-model="sort" id="sort-by-donors" class="custom-control-input"
                                            type="radio" name="sort" value="donors">
                                        <label class="custom-control-label" for="sort-by-donors">
                                            по количеству доноров
                                        </label>
                                    </div>
                                </div>

                                <button class="btn btn-sm btn-outline-info" @click="sort = null;">Сбросить</button>
                            </div>
                        </div>

                        <!-- Фильтр -->
                        <div class="col-xs-12 col-lg">
                            <div class="col-12 border border-secondary p-3 rounded">

                                <div class="form-group">
                                    <label class="lead">Фильтр</label>
                                </div>

                                <div class="form-group">
                                    <div class="custom-control custom-switch mb-1">
                                        <input type="checkbox" class="custom-control-input" id="firstShot"
                                            v-model="filter.firstShot">
                                        <label class="custom-control-label" for="firstShot">Первый снимок сделан
                                            до:</label>
                                    </div>
                                    <input type="month" v-model="filter.firstShotDate"
                                        class="form-control form-control-sm" style="max-width: 220px;">
                                </div>

                                <div class="form-group">
                                    <div class="custom-control custom-switch mb-1">
                                        <input type="checkbox" class="custom-control-input" id="lastShot"
                                            v-model="filter.lastShot">
                                        <label class="custom-control-label" for="lastShot">Последний снимок
                                            сделан после:</label>
                                    </div>
                                    <input type="month" v-model="filter.lastShotDate"
                                        class="form-control form-control-sm" style="max-width: 220px;">
                                </div>

                                <div class="form-group">
                                    <div class="custom-control custom-switch">
                                        <input type="checkbox" class="custom-control-input" id="hideErrors"
                                            name="hideErrors" v-model="filter.hideErrors">
                                        <label class="custom-control-label" for="hideErrors">Скрывать результаты с
                                            ошибками</label>
                                    </div>
                                </div>

                            </div>
                        </div>

                    </div>

                    <div v-if="isBusy" class="progress"
                        style="height: 5px; border-radius: 0; position: absolute; bottom: -1px; left: -1px; width: 100%;">

                        <div role="progressbar" class="progress-bar progress-bar-striped progress-bar-animated"
                            style="width: 100%; position: absolute; height: 5px; opacity: 0.4;">
                        </div>

                        <div role="progressbar"
                            class="progress-bar progress-bar-striped progress-bar-animated bg-success"
                            v-bind:style="'width:' + 100 / domains.length * items.length +'%'">
                        </div>

                    </div>

                </div>

                <div class="mt-3" id="container">
                    <!-- <card-component v-for="item in items" :item="item" :key="item.id"></card-component> -->
                    <card-component v-for="item in filteredItems" :item="item" :key="item.id"></card-component>
                </div>

            </div>

            <div class="tab-pane show" id="query" role="tabpanel" aria-labelledby="query-tab">

                <div class="card border-secondary border-top-0 rounded-0">
                    <div class="card-body">
                        Все еще в разработке...
                    </div>
                    <div class="card-footer">
                        ⏳
                    </div>
                </div>

            </div>
        </div>

    </main>

    <script type="text/x-template" id="card-component">
        <div v-bind:class="[item.isError ? 'border-danger' : 'border-success', 'card mb-3']">

            <div class="card-body p-3">
                <h4 class="m-0 p-0">{{ item.domain }}</h4>
                <!-- <button type="button" class="close" data-dismiss="alert">&times;</button> -->
            </div>

            <div v-if="item.isError">

                <div class="card-body text-danger">
                    {{ item.errorText }}
                </div>

            </div>
            <div v-else>
                
                <div class="card__image-wrapper ml-3 mr-3 rounded">
                    <img class="card__image" v-bind:src="'data:image/png;base64,' + item.img">
                </div>

                <div class="card-body p-3 row">
                    <div class="col-12 col-lg-4">
                        <p class="pt-1 pb-1 m-0">Перейти на <a v-bind:href="'https://' + item.domain" target="_blank">{{ item.domain }}</a></p>
                        <p class="pt-1 pb-1 m-0">Подробно на <a v-bind:href="'http://web.archive.org/web/*/' + item.domain" target="_blank">web.archive.org</a></p>
                    </div>
                    <div v-if="item.links.length" class="col-12 col-md-4">
                        <p class="pt-1 pb-1 m-0" v-if="item.links[0]">Первый снимок <a v-bind:href="item.links[0].href" target="_blank">{{ item.links[0].innerText }}</a></p>
                        <p class="pt-1 pb-1 m-0" v-if="item.links[1]">Последний снимок <a v-bind:href="item.links[1].href" target="_blank">{{ item.links[1].innerText }}</a></p>
                        <p class="pt-1 pb-1 m-0" v-else="item.links[0]">Последний снимок <a v-bind:href="item.links[0].href" target="_blank">{{ item.links[0].innerText }}</a></p>
                    </div>
                    <div class="col-12 col-lg-4">
                        <p class="pt-1 pb-1 m-0">Доноры <a v-bind:href="'https://www.linkpad.ru/?search=' + item.domain" target="_blank">{{ item.donors }}</a></p>
                    </div>
                </div>

            </div>

        </div>
    </script>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script type="module" src="js/index.js"></script>

</body>

</html>
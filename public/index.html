<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Domain Checker</title>

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#2d89ef">
    <meta name="theme-color" content="#111111">

    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/bootstrap.min.css">
</head>

<body>

    <header class="container mb-3">
        <h1>
            <a href="/" style="font-size: 0.62em;">Domain Checker</a>
        </h1>
    </header>

    <main class="container mt-2" id="app">

        <!-- ФОРМА -->
        <div class="card border-secondary rounded-2">

            <div class="row card-body">

                <!-- Форма -->
                <div class="col">
                    <form @submit.prevent="onSubmit" class="col mb-3">
                        <div class="form-group">
                            <label class="lead" for="domains">Домены или поисковый запрос</label>
                            <textarea class="form-control" name="domains" id="domains" rows="7" cols="3"
                                      placeholder="example.com" v-model="textareaText" @input="checkMode"
                                      v-bind:disabled="blockForm"></textarea>
                        </div>

                        <input class="btn btn-primary mr-2 mb-3" type="submit"
                               v-bind:disabled="blockForm || !textareaText.length"
                               :value="mode === 'search' ? 'Проверить запрос': 'Проверить домены'">
                        <input class="btn btn-outline-danger mb-3" type="reset" @click="this.textareaText = ''"
                               v-bind:disabled="blockForm || !textareaText.length" value="Очистить поле">
                    </form>
                </div>

                <!-- Сортировка -->
                <div class="col-xs-12 col-md">
                    <div class="col border border-secondary rounded p-3 mb-3">
                        <div class="form-group">
                            <label class="lead">Сортировка</label>
                        </div>

                        <div class="form-group">
                            <div class="custom-control custom-radio mb-1">
                                <input v-model="sort" id="sort-by-alphabet" class="custom-control-input" type="radio"
                                       name="sort" value="alphabet">
                                <label class="custom-control-label" for="sort-by-alphabet">
                                    по алфавиту
                                </label>
                            </div>

                            <div class="custom-control custom-radio mb-1">
                                <input v-model="sort" id="sort-by-age" class="custom-control-input" type="radio"
                                       name="sort" value="age">
                                <label class="custom-control-label" for="sort-by-age">
                                    по возрасту
                                </label>
                            </div>

                            <div class="custom-control custom-radio">
                                <input v-model="sort" id="sort-by-donors" class="custom-control-input" type="radio"
                                       name="sort" value="donors">
                                <label class="custom-control-label" for="sort-by-donors">
                                    по количеству доноров
                                </label>
                            </div>
                        </div>

                        <button class="btn btn-sm btn-outline-info" @click="sort = null;">Сбросить</button>
                    </div>
                </div>

                <!-- Фильтр -->
                <div class="col-xs-12 col-lg">
                    <div class="col-12 border border-secondary p-3 rounded">

                        <div class="form-group">
                            <label class="lead">Фильтры</label>
                        </div>

                        <div class="form-group">
                            <div class="custom-control custom-switch mb-1">
                                <input type="checkbox" class="custom-control-input" id="firstShot"
                                       v-model="filter.firstShot">
                                <label class="custom-control-label" for="firstShot">Первый снимок сделан
                                    до:</label>
                            </div>
                            <input type="month" v-model="filter.firstShotDate" class="form-control form-control-sm"
                                   style="max-width: 220px;">
                        </div>

                        <div class="form-group">
                            <div class="custom-control custom-switch mb-1">
                                <input type="checkbox" class="custom-control-input" id="lastShot"
                                       v-model="filter.lastShot">
                                <label class="custom-control-label" for="lastShot">Последний снимок
                                    сделан после:</label>
                            </div>
                            <input type="month" v-model="filter.lastShotDate" class="form-control form-control-sm"
                                   style="max-width: 220px;">
                        </div>

                        <hr class="border-secondary ml-n3 mr-n3 mt-4 mb-4">

                        <div class="form-group mb-2">
                            <div class="custom-control custom-switch">
                                <input type="checkbox" class="custom-control-input" id="hideErrors" name="hideErrors"
                                       v-model="filter.hideErrors">
                                <label class="custom-control-label" for="hideErrors">Скрывать результаты с
                                    ошибками</label>
                            </div>
                        </div>

                    </div>
                </div>

            </div>
            <div v-if="progress.visible" :data-text='progress.text' class="progress"
                 style="height: 5px; border-radius: 0; position: absolute; bottom: -1px; left: -1px; width: 100%;">

                <div role="progressbar" class="progress-bar progress-bar-striped progress-bar-animated"
                     style="width: 100%; position: absolute; height: 5px; opacity: 0.4;">
                </div>

                <div role="progressbar" class="progress-bar progress-bar-striped progress-bar-animated bg-success"
                     :style="'width:'+progress.value+'%'">
                </div>

            </div>

        </div>

        <!-- РЕЗУЛЬТАТЫ -->
        <div class="mt-5" id="container">

            <!-- Вкладки - Pills -->
            <ul class="nav nav-pills">
                <list-pill-component v-for="list in lists" :list="list" :lists="lists" :key="list.id"
                                     v-on:switchtab="switchTab(list.id)"></list-pill-component>
            </ul>

            <!-- Контент - Tabs -->
            <div class="tab-content mt-3">
                <list-component v-for="list in lists" :list="list" :filter="filter" :sort="sort" :key="list.id">
                </list-component>
            </div>

        </div>

    </main>

    <script type="text/x-template" id="card-component">
        <div v-bind:class="[item.isError ? 'border-danger' : 'border-success', 'card mb-3']">

            <div class="card-body p-3">
                <h4 class="m-0 p-0"><a v-bind:href="'https://' + item.domain" target="_blank">{{ item.domain }}</a></h4>
            </div>

            <small v-if="item.isError" class="card-body text-danger py-0">{{ item.errorText }}</small>

            <div v-if="item.img && item.img.length" class="card__image-wrapper ml-3 mr-3 rounded">
                <img class="card__image" v-bind:src="'data:image/png;base64,' + item.img">
            </div>

            <div class="card-body p-3 row">
                <div class="col-12 col-lg-4">
                    <p class="pt-1 pb-1 m-0">Подробно на <a v-bind:href="'http://web.archive.org/web/*/' + item.domain" target="_blank">web.archive.org</a></p>
                    <p class="pt-1 pb-1 m-0">Подробно на <a v-bind:href="'https://www.linkpad.ru/?search=' + item.domain" target="_blank">linkpad.ru</a></p>
                </div>
                <div v-if="item.links && item.links.length" class="col-12 col-md-4">
                    <p class="pt-1 pb-1 m-0" v-if="item.links[0]">Первый снимок <a v-bind:href="item.links[0].href" target="_blank">{{ item.links[0].innerText }}</a></p>
                    <p class="pt-1 pb-1 m-0" v-if="item.links[1]">Последний снимок <a v-bind:href="item.links[1].href" target="_blank">{{ item.links[1].innerText }}</a></p>
                    <p class="pt-1 pb-1 m-0" v-else="item.links[0]">Последний снимок <a v-bind:href="item.links[0].href" target="_blank">{{ item.links[0].innerText }}</a></p>
                </div>
                <div class="col-12 col-lg-4">
                    <p class="pt-1 pb-1 m-0" v-if="item.title">Тайтл <a v-bind:href="item.url" target="_blank">{{ item.title }}</a></p>
                </div>
            </div>

        </div>
    </script>

    <script type="text/x-template" id="list-component">
        <div v-bind:id="'list' + list.id" v-bind:class="[list.isActive ? 'active' : '', 'tab-pane']">
            <card-component v-for="item in computedItems" :item="item" :key="item.id"></card-component>
        </div>
    </script>

    <script type="text/x-template" id="list-pill-component">
        <li class="nav-item mr-2 mb-2">
            <a v-bind:class="[list.isActive ? 'active' : 'bg-secondary', 'nav-link fs-sm']" @click="$emit('switchtab')" style="padding: 3px 10px;" data-toggle="tab"
            v-bind:href="'#list' + list.id">
            <div v-if="list.isBusy" class="spinner-border spinner-border-sm" style="margin: 0 4px 1px 0">
                <span class="sr-only">Loading...</span>
            </div>
            {{computedName}}
            <button v-if="!list.isBusy" @click="deleteList(list.id)" type="button" class="close" style="line-height: 100%; margin-left: 6px">
                <span aria-hidden="true" class="mb-2">&times;</span>
            </button>
        </a>
        </li>
    </script>

    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script type="module" src="js/index.js"></script>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
            integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
            integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
            integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
            crossorigin="anonymous"></script>

</body>

</html>